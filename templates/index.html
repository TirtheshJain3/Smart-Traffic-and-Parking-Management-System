<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Solapur Smart Traffic â€“ TomTom</title>

<link rel="stylesheet"
href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.23.0/maps/maps.css"/>

<style>
html, body { height: 100%; margin: 0; }
#map { height: 100%; width: 100%; }
.legend {
  position: absolute;
  bottom: 15px;
  left: 15px;
  background: white;
  padding: 10px;
  font-family: Arial;
  box-shadow: 0 0 6px rgba(0,0,0,0.3);
}
</style>
</head>

<body>

<div id="map"></div>

<div class="legend">
<b>Traffic</b><br>
ðŸŸ¢ Free<br>
ðŸŸ  Moderate<br>
ðŸ”´ Heavy<br>
ðŸš§ Incident
</div>

<script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.23.0/maps/maps-web.min.js"></script>

<script>
const TOMTOM_API_KEY = "YOUR_TOMTOM_API_KEY";

/* SOLAPUR MAP */
const map = tt.map({
  key: TOMTOM_API_KEY,
  container: "map",
  center: [75.9064, 17.6599], // lng, lat
  zoom: 13,
  minZoom: 12,
  maxZoom: 18,
  maxBounds: [
    [75.80, 17.55],
    [76.00, 17.75]
  ]
});

/* TRAFFIC FLOW (OFFICIAL) */
map.on("load", () => {
  map.addControl(
    new tt.TrafficFlowControl({
      theme: { style: "relative-delay", source: "vector" },
      refresh: 30000
    })
  );

  map.addControl(
    new tt.TrafficIncidentsControl({
      incidentTiles: { style: "tomtom://vector/1/s3" }
    })
  );

  loadIncidentJSON();
});

/* LOAD INCIDENT JSON FROM PYTHON */
function loadIncidentJSON() {
  fetch("/data/traffic_incidents.json")
    .then(r => r.json())
    .then(data => {
      data.incidents.forEach(i => {
        if (!i.coordinates || i.coordinates.length === 0) return;

        const coord = i.coordinates[0]; // [lng,lat]

        const marker = new tt.Marker({ color: "red" })
          .setLngLat(coord)
          .addTo(map);

        marker.setPopup(
          new tt.Popup({ offset: 25 })
            .setHTML(`<b>ðŸš§ Incident</b><br>${i.description || "No details"}`)
        );
      });
    });
}
</script>

</body>
</html>
